<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Google Doc Access with QR Unlock</title>

<style>
  body {
    margin: 0; 
    font-family: Arial, Helvetica, sans-serif;
    background: #cc0000;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .container {
    position: relative;
    background: white;
    width: 66vw;
    height: 95vh;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 0 15px #900000;
    display: block;
  }

  iframe.google-doc-embed {
    border: none;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.15);
  }

  #lock-overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.75);
    z-index: 10;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
    text-align: center;
    padding: 20px;
    border-radius: 12px;
  }

  #qr-reader {
    width: 480px;
    height: 480px;
    margin-top: 20px;
    border: 2px solid #4caf50;
    border-radius: 8px;
  }

  #access-granted {
    margin-top: 15px;
    font-size: 1.25rem;
    color: #4caf50;
    font-weight: 700;
    display: none;
  }

  #welcome-text {
    margin-top: 10px;
    font-size: 1.2rem;
    color: #ffffff;
  }

  footer.footer {
    text-align: center;
    margin: 10px 0;
    font-size: 0.9rem;
    color: #fff;
  }
</style>
</head>
<body>

<div class="container">
  <iframe
    class="google-doc-embed"
    src="https://docs.google.com/spreadsheets/d/1VkmEMHessu7u9YXpCd3-BBNeISvHIZVPiaNYlTwEiI8/edit?usp=sharing"
    title="Google Sheets Document"
    allowfullscreen
    scrolling="yes"
  ></iframe>

  <div id="lock-overlay">
    <div>Scan QR code on badge to gain access</div>
    <div id="qr-reader"></div>
    <div id="access-granted">Access Granted!</div>
    <div id="welcome-text">Welcome to Nexus Construction Check Sheet</div>
  </div>
</div>

<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<script>
  const lockOverlay = document.getElementById('lock-overlay');
  const accessGrantedMsg = document.getElementById('access-granted');
  let qrScanner = null;

  function unlockAccess() {
    accessGrantedMsg.style.display = 'block';
    setTimeout(() => {
      lockOverlay.style.display = 'none';
    }, 1200);
    if (qrScanner) qrScanner.stop().catch(() => {});
  }

  function startScanner() {
    qrScanner = new Html5Qrcode("qr-reader");

    const config = { fps: 10, qrbox: { width: 360, height: 360 } };

    qrScanner.start(
      { facingMode: "environment" },
      config,
      code => { if (/^\d{7}$/.test(code.trim())) unlockAccess(); },
      () => {}
    ).catch(() => {
      qrScanner.start(
        { facingMode: "user" },
        config,
        code => { if (/^\d{7}$/.test(code.trim())) unlockAccess(); },
        () => {}
      ).catch(() => {
        alert('Failed to start camera for QR scanning. Please check permissions.');
      });
    });
  }

  window.addEventListener('load', startScanner);
</script>

<footer class="footer">Â© Intellectual Property of NEXUS Data Science. Created in joint venture with ACE Electric. All rights reserved.</footer>

</body>
</html>
